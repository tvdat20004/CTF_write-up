from random import getrandbits
from z3 import *



def gen_output(A, B, a0, b0):
    # output = gen_output(A,B) ^ A[0] ^ B[0]
    return Xor(Xor(A[3-1], And(A[7-1], A[8-1]), And(B[4-1], B[5-1])), Xor(B[7-1], a0==1, b0==1))

def gen_last_bit_A(A, a0):
    return A[-1] == Xor(A[12], A[43], And(a0==1, A[1]))
def gen_last_bit_B(B, b0):
    return B[-1] == Xor(B[10], B[47], And(b0==1, B[1]))
def get_all_solutions(s, variables):
    solutions = []
    while s.check() == sat:
        m = s.model()
        solution = [m[v].as_long() for v in variables]
        solutions.append(solution)
        # Add a constraint to block the current solution
        block = []
        for v in variables:
            block.append(v != m[v])
        s.add(Or(block))
    return solutions
def int_to_bool(x):
    return If(x==1, True, False)
S = Solver()
a0 = BitVec('a0', 1)
b0 = BitVec('b0', 1)
keystream = "10101001101000000011010110001110010110000011111110110111010000011011011110100010110001010101001111101111000101000011110011111110000001101001001110010100001101101100110111000000101000101000110111111100001000110001101111100111101100110110011111001000000011100100001000001111100010000101111100000111000111111101001101111001100100001110100101110100101000011111001100011001100010101000101010010001010100000001010000111010101001000000111111011001011110010100011111011101111100111010111100010010110010001010111001100111101000000011011010001101000011111101100100001011000101011100100111111110101011111001011110001000111101111000011111100010111001101101100001011010000000011101110010110010110011001010001011110011011010100010110000010011111000000000100011000001110001100010111100110010110011001001010100101111010101010101001011011011101001110011010101110101111111001111000100011011011111001010100011001001011100011101000000111011111111001000011111010011001110001011101001001111111111010001011011101000000101100101000101110110101011100000101100011110101110100000101100100110001011111000000110110101110101011011010010111100000001010111011110100110100100100010101111001000111101010010011010000010101111000011100001100101101110110110110010000101000100010101110100101011000101010011111110100000100000110001001111011101001100100111101011100000101110111100101100001010111111100010100011000101111010110111110010010010101100010001001101110101000101111111000111101100100101111011100101100010100010110010001001001110110110110000000100100110000011010111011110111101000011000011101000000001010011111100110111101110110000100011010101100001011110011101001110101100101110000010011001011001110010110111100010110101100001011111001111110111100000000101011100100010101100010010110100101011100110100000110110110000010011000000100101101111001001001011110101101101100101000011111011000110101010111000000100001111111111001110100010000000011001111101101111100001111100010011110100111000001001101000111000111110110100011001000000111001100010010110011000110000001100111000011000010011101001000111100001100001111110000001110000011110010101111010110101001001100001010100011000110101000000111100000101001001011000000010011010111011000010110110001110001100010111011101111100000010100001010000010100110111001110100110101110110010011001001010000101010001110010101111110011000010011111000100100110010011111110111000100110110010000000100010001011110011000001100011011110111111010111110000001100011101110010101000100101100011011011110010101000111110110010110101011001001110011010100101001011000011111010000110110101111011111101000111101110011110110111110001110101011010001010010100000011000011011101001000100010101010101001010110001010100110010000111011110000111000001110100011101111010111010110010101010101110000100110010011000101010010101000000000101010001011011001000110111100011110011000010011110111011101101101010010101011010001100000110101101100111000100101000101100000010101000110010010011101111011111011101010010101001011111000101100110100000110000011110011001111111110000111100101100111001100001000110000000100100110000110100000100000101110001011010111001110011111101111010000010000000001111001101110000011100101111000100100000100110100110100010100000000101100100000111010100000111111100011010000110010001000101010100001101001100011010001101100101111011010000100000110011000110100011110010100011100001101111000110001011001110111011111011000111101010001100000011110010101101100010011100010110010100111100101100110100010110111000100000110001010111000001011001101000111010111000011100111001011000110110001111111101011000110000001011000000110001011011111110110111011110001011000101010001100111101110010100001111101101100100100110011111110110000101100101111010000000011001010111100101100100010110101010111001000100101111110111001100101100011101111110100110111111100101111011001010110111001011101001000100101011000001001100111111101100011110010010101110000011001010101101001110010001011100010001001010110010011000011010010001000111111110111110111000010011101101001010000001100010100001001011100010001110100111000111011010000111111000101000001111010110000110100111010001010101011011011111010111000011000001100100010101001100011000010101010101001110011000110111111111001010110111101100100001001110101100001101111000000100100001001001011000111111111010111001101101001111000100000001010001011011100111010111111010001100101001010001101100101010110110010111100011010000011010101000010011001100001000111101011100110101000110011110011010110001010110001011101101100000100110010010000000100010001001100111001110010101111100010100110010111001110110000111101100101101011000001010100110111101010110011010100110101101011001110111111010100110001010110001010001011011010011101011000010101110111100110000001111011101010101010000100001001011001110110100000000000110000011101111111110001000111000011100110100100011010110000110000010110101101110110000111101101101001100101001110001101101100000110111101111000001010101101101110101001000101100100000101110101101101011111101110001000010100000101010011111011100000000001101111100100100010110010111110110001100001011010000110000100011110000001000000100001000011001110010110010010110010000010111011111110110100000011010101100010000010110001111101010010010001000010100001011101110100100000100111000111110000001110110000101000100000000110011000001111011110101101010110000111000110000011111100001001001000110101100011111011011111011010011011110001110011010100001110111001110000111100111111110110110101101000010001011111111011101111100100011111111100011011001101101101111101111001011010011101000000100100100000101000001000101000110101000100011010001110000000110110111101100111111100101110011000011101101010111000011101000011110100011111011001111010100001000101110010100000000010000001100011001001001001101010000101010011110110111000000010100011101010101001011011111100110110111101100010111011001100011000001100000101000001110110110010111111111010110101101011001011010110111011001011010100000111011100001111000000100010000100110101000101101111101011000101011101111101011101101100110011111010110111101110001111110000010100101010100101000111001000110111000000110000110001000101011001101000110111111011110111110001100000100100110001110110010011011011100111011111001001000111010001101111001100001000000011111100011110011010010011101101110101000111011111110111010100000010111001000110000110000000110011101101100111101110000101110010010001111001001001110010111000101111000000110000011111100010110101111111011001110010011101000110011011111101010001110001001110011001001100001101001110001100011110100101000101101100111110001100110011001001000001000000000101000101010101111001111010011110101101110011010101010000111110011110111110010000110110000100110010100111000111000001001001111110101101111000110110011011011100111011101101111000110010011111111111001110110010110101100011100100001110001001101001100011000011100000001100100100100011101100001011101101101100010001010011001001000010110110011010011100010101110111000000010001101110001101100000101010111011011111001110011001100010001101101011010111110101010000101010010010101111011001011110010000110100011000101011100111001100110111100001100001010101001010110110001110010011111010111100010010001010011110011011001011000111111011000101011101111001001101100011101001001101000011010001100110000001111011101110101000000011001011110011111000101011010111001001011100000101010110111011111001101011001110101001000010010010011100110111011011001011101110100011111110001110100111101100100101001010001000010000100011100011111001100100100011000101101110110110010111100111100010110011110000000101100110100010101100010101010001111100001010101110100001110101011111110101101111001011011000011110100001010111000110000111000011011000111000000100010101001010110010011000100111000111111100101100001000001100001011110101111010100011100111000101110000011111101100101100001110100111101001111011010110001001100100010110011100111100011010010110001000010100111010111100010110101101010011111110111001100110011101000110000001010100101101111100000111000011010011110000000100001001001111010101000001011111101000010111000011100000110010100100111100110000111010000001010000110000011111111101000111010100101111"
keystream = [int_to_bool(i) for i in keystream]
A8192 = "00101001110001001110111001100001010100000101110"
B8192 = "0000010000101001000011000001010111001110000100101"
A8192 = [int_to_bool(i) for i in A8192]
B8192 = [int_to_bool(i) for i in B8192]

S.add(gen_output(A8192, B8192, a0, b0) == keystream[-2])
S.add(gen_last_bit_A(A8192, a0))
S.add(gen_last_bit_B(B8192, b0))
print(get_all_solutions(S, []))
